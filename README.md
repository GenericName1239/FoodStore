# FoodStore

//-----Identity => Login, Register

За логин и регистрация използвам Identity api, което можеш да видиш като регистриран сървис в Startup при ConfigureServices
където се регистрират и всички други сървиси използвани в приложението. Съврвисите се регистрират в контейнер имплементиращ IServiceCollection
за резолване на сървисите по време на рънтайм чрез dependency injection. 
Identity сервиса използва два мидълуер метода -> AddAuthentication и AddAuthorization служещи за проверка на бисквитката на потребителя 
и съответно изпращане на chalange response ако такава не е налична или на 403 login denied.

UseEndpoinds мидъуеъра се използва за мапване на url към ендпоинт. Ендпоинт в случая може да е HomeController-а или някой razor page.

//----DbContext
FoodStoreContext се използва за конф на базата, регистрация на persistant classes демек ентититата в базата от които ще стават таблиците и тн,
използване на връзката към базата, проверки и други методи за работа с базата.
 OnModelCreating се използва за конф на връзките между таблиците т.е fk ключовете и доп конф за колоните и типа на данните в тях.
 
 //---HomeController
 HomeController-a предоставя продуктите от базата и ако има намалени продукти за текущия потребител цените на продуктите се коригират.
 Допълнително се сийдва и Trie което е дървовидна структора подходяща за търсене и доп хеш таблица за всеки продкт това е да се избегнат твърде много заявки към сървъра.
 
 //Admin
 Достъпва се чрез -> Admin/Admin
 SeedAdminData.Seed(userManager, roleManager).Wait(); в Startup.cs се използва за сийдване на админа, ако не съществува.
 [Authorize(Roles = "administrator")] атрибута се използва за оказване на Identity, че този ендпойнт изисква автентикация и доп роля за админ
 
UserManager<Т> се използва за работа с юзърите от базата, като за тяхното съхранение се използва IUserStore в случая използвам дефаутнатия от Microsoft 
  за работа с ентити.
  Админа за сега може само да търси потребител, да ъпдейтва роля, която предварително трябва да се създаде в базата и да изтрива потребители.
  Ако ролята е валидна потребителят се ъпдейтва и при следващо влизане от негова страна всички продукти ще бъдат намалени
  според оказаните проценти в базата за дадена роля т.е 
  роля Silver -> 0,10% или Gold -> 0,20% ролите и процентите са примерни.
  Чрез claim в приложението се оказва роля.
  
  //Login
  За SignIn и SignOut Identity използваSignInManager<Т> като при успешно логване се създава бисквитката за потребителя, а SignOut премахва бисквитката.
  AddIdentityErrors е екстеншън метод за добавяне на грешки от SignInResult
  
  За времето на разработка съм оказал умишлено ниска защита на паролата от Identity
  ако желаеш можеш да я променяш от Startup.cs чрез options патерна в AddIdentity
  
  
  
  
